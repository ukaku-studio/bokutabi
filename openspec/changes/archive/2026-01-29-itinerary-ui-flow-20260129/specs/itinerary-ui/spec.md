## ADDED Requirements

### Requirement: 旅程作成の確認・保存フロー
システムは「内容を確認する」からプレビュー画面を表示し、保存/修正の選択肢を提供しなければならない（SHALL）。

#### Scenario: タイトル未入力で確認ボタンを押した場合
- **WHEN** ユーザーが「内容を確認する」を押す
- **AND** タイトルが未入力である
- **THEN** 「タイトルを入力してください」とトースト表示する
- **AND** タイトル入力欄にエラー状態を付与する

#### Scenario: 確認ボタンからプレビューへ遷移する
- **WHEN** ユーザーが「内容を確認する」を押す
- **AND** タイトルが入力済みである
- **THEN** 現在の入力内容をプレビュー用に保存しプレビュー画面を表示する

#### Scenario: プレビュー画面で修正する
- **WHEN** ユーザーがプレビュー画面の「修正する」を押す
- **THEN** 編集画面へ戻る

#### Scenario: プレビュー画面で保存する
- **WHEN** ユーザーがプレビュー画面の「保存する」を押す
- **THEN** 編集画面に戻り保存モーダルを表示する

### Requirement: プレビュー画面の表示ルール
システムはプレビュー画面で日付・時刻の表示ルールを次の通り提供しなければならない（SHALL）。

#### Scenario: 日付ラベルの表示
- **WHEN** プレビュー画面で日付グループを表示する
- **THEN** 日付ラベルを大きめのサイズで表示する
- **AND** 日付が未設定の場合は「日付未設定」と表示する

#### Scenario: パネルの時刻表示
- **WHEN** パネルの時刻が設定されている
- **THEN** パネル左上に時刻を表示する
- **WHEN** パネルの時刻が未設定
- **THEN** パネル左上に日付を表示する
- **AND** 日付が未設定の場合は「日付未設定」と表示する

#### Scenario: 位置情報の非表示
- **WHEN** プレビュー画面を表示する
- **THEN** 緯度経度情報は表示しない

### Requirement: 旅程パネルの空状態と追加挙動
システムは旅程パネルの空状態と追加の挙動を一貫して扱わなければならない（SHALL）。

#### Scenario: 空パネルは1つのみ
- **WHEN** 旅程パネルが複数空状態になる
- **THEN** 空パネルは1つのみ残す

#### Scenario: 空パネルがある場合の追加
- **WHEN** 既に空パネルが存在する状態で「＋」を押す
- **THEN** 「すでに空の旅程ステップパネルが追加されています」とトースト表示する

#### Scenario: 追加パネルの日付引き継ぎ
- **WHEN** 直前のパネルに日付がある状態で新規パネルを追加する
- **THEN** 新規パネルは直前のパネルの日付を引き継ぐ

### Requirement: 移動時間候補の選択と強調
システムは移動時間候補の選択状態を分かりやすく示さなければならない（SHALL）。

#### Scenario: 候補の表示条件
- **WHEN** 直前のパネルに時刻と場所が設定されている
- **AND** 現在のパネルに場所が設定されている
- **THEN** 移動時間候補を表示する

#### Scenario: 候補選択の反映
- **WHEN** ユーザーが移動時間候補を選択する
- **THEN** 選択した候補を強調表示する
- **AND** 到着時刻を現在のパネルに反映する
- **AND** 日付が未設定の場合は直前の日付を反映する
- **AND** 翌日到着の場合は日付を翌日に更新する

#### Scenario: 手入力で時刻変更した場合
- **WHEN** ユーザーが時刻を手入力で変更する
- **THEN** 候補選択の強調を解除する

### Requirement: 位置設定ボタンの見た目
システムは位置未設定/設定済みで見た目を切り替えなければならない（SHALL）。

#### Scenario: 位置未設定
- **WHEN** パネルの位置が未設定である
- **THEN** 位置設定ボタンはオレンジ系の強調表示とする

#### Scenario: 位置設定済み
- **WHEN** パネルの位置が設定済みである
- **THEN** 位置設定ボタンは通常の白背景の表示とする

### Requirement: 位置検索モーダルのUX
システムは位置検索モーダルの文言と表示を次の通り提供しなければならない（SHALL）。

#### Scenario: 検索ボタンの表示
- **WHEN** 検索中である
- **THEN** 検索ボタンは非活性になる
- **AND** 検索ボタンの文言は変化しない

#### Scenario: 検索中の表示
- **WHEN** 検索中である
- **THEN** マップ領域の「検索中」文言は表示される

### Requirement: 公式名と住所の表示ルール
システムは公式名がある場合の住所表示を抑制しなければならない（SHALL）。

#### Scenario: 公式名がある場合
- **WHEN** 公式名を含む検索結果が取得される
- **THEN** 住所の表示は行わない

#### Scenario: 公式名がない場合
- **WHEN** 公式名が取得できない検索結果である
- **THEN** 住所を表示する

#### Scenario: 再検索時の入力値
- **WHEN** 位置検索モーダルを再度開く
- **THEN** 検索欄には公式名を設定する

### Requirement: 位置検索の言語優先順位とフォールバック
システムは言語設定に合わせて位置検索を実行しなければならない（SHALL）。

#### Scenario: 言語優先順位
- **WHEN** ユーザーがホームで日本語/英語を選択している
- **THEN** その言語を最優先で検索に使用する
- **WHEN** 言語が未選択である
- **THEN** ブラウザの言語設定を使用する

#### Scenario: 日本語/英語の両対応
- **WHEN** 日本語検索で結果が得られない
- **THEN** 英語で再検索する
- **WHEN** 英語検索で結果が得られない
- **THEN** 日本語で再検索する
- **AND** 言語指定なしの検索を最後に試行する

### Requirement: 初回アクセス時のテーマと言語
システムは初回アクセス時にブラウザ設定を引き継がなければならない（SHALL）。

#### Scenario: テーマの初期値
- **WHEN** ローカルストレージにテーマ設定が存在しない
- **THEN** ブラウザのダーク/ライト設定を初期値に使用する

#### Scenario: 言語の初期値
- **WHEN** ローカルストレージに言語設定が存在しない
- **THEN** ブラウザの言語設定を初期値に使用する
- **AND** 日本語以外は英語として扱う

### Requirement: 旅程画面の初期パネル
システムは旅程画面の初回表示で空のパネルを1つ表示しなければならない（SHALL）。

#### Scenario: 旅程が空の場合
- **WHEN** 旅程アイテムが0件である
- **THEN** 空のパネルを1件表示する
